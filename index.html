<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Zer0 Emission Games</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=103598496', 'ym');

        ym(103598496, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/103598496" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            background: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        #splash {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #splash img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #splash.hidden {
            display: none;
        }

        #app {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        #app.visible {
            display: flex;
        }

        .logo {
            width: 200px;
            height: auto;
            margin-bottom: 40px;
        }

        #gamesMenu, #appStoreMenu, #aboutMenu, #termsMenu {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 0 20px;
        }

        #faqMenu {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 0 20px;
        }

        .btn {
            width: 280px;
            height: 56px;
            margin: 12px 0;
            border-radius: 16px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-play {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-app {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-about {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-support {
            background: #B7DB2A;
            color: white;
        }

        .btn-game {
            background: #B7DB2A;
            color: white;
        }

        .btn-about-item {
            background: #EFEFEF;
            color: #1a1a1a;
        }

        .btn-store {
            width: 280px;
            height: 64px;
            margin: 8px 0;
            border-radius: 16px;
            border: 2px solid #E5E5EA;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 20px;
            transition: all 0.2s ease;
            background: white;
            color: #1a1a1a;
        }

        .btn-store:active {
            transform: scale(0.96);
            background: #F7F7F7;
        }

        .btn-store:hover {
            border-color: #007AFF;
        }

        .store-icon {
            width: 32px;
            height: 32px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .store-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .store-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .store-title {
            font-size: 17px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .store-subtitle {
            font-size: 13px;
            color: #8E8E93;
            margin-top: 2px;
        }

        .btn-back {
            background: #FF3B30;
            color: white;
            margin-top: 24px;
            flex-shrink: 0;
        }

        h2 {
            color: #1a1a1a;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1001;
            display: none;
            background: #000;
        }

        .faq-container, .terms-container {
            width: 100%;
            max-width: 320px;
            margin-bottom: 20px;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .terms-content {
            padding: 16px;
            background: #F7F7F7;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            text-align: left;
        }

        .terms-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 16px 0 8px 0;
            color: #1a1a1a;
        }

        .terms-content h3:first-child {
            margin-top: 0;
        }

        .terms-content p {
            margin-bottom: 12px;
        }

        .terms-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .terms-content li {
            margin-bottom: 6px;
        }

        .faq-item {
            margin-bottom: 16px;
            border-radius: 12px;
            background: #F7F7F7;
            overflow: hidden;
        }

        .faq-question {
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-question::after {
            content: '+';
            font-size: 20px;
            font-weight: 400;
            color: #8E8E93;
        }

        .faq-answer {
            padding: 0 16px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            font-size: 14px;
            line-height: 1.4;
            color: #666;
        }

        .faq-item.active .faq-answer {
            padding: 0 16px 16px;
            max-height: 500px;
        }

        .faq-item.active .faq-question::after {
            content: '-';
        }
    </style>
</head>
<body>
<div id="splash">
    <img alt="Splash Screen" src="ZM.png">
</div>

<div id="app">
    <img src="ZE_logo.png" alt="Zero Emission Logo" class="logo">
    <button class="btn btn-support" id="supportBtn">Техническая поддержка</button>
    <button class="btn btn-play" id="playBtn">Игры</button>
    <button class="btn btn-app" id="appBtn">Мобильное приложение</button>
    <button class="btn btn-about" id="aboutBtn">О приложении</button>

    <div id="gamesMenu">
        <h2>Выберите игру</h2>
        <button class="btn btn-game" id="clumsyBirdBtn">Clumsy Bird</button>
        <button class="btn btn-game" id="pacmanBtn">Pacman Canvas</button>
        <button class="btn btn-back" id="backBtn">Назад</button>
    </div>

    <div id="appStoreMenu">
        <h2>Скачать приложение</h2>
        <button class="btn-store" id="appStoreBtn">
            <span class="store-icon">
                <img src="AppStore.svg" alt="App Store">
            </span>
            <div class="store-text">
                <span class="store-title">App Store</span>
                <span class="store-subtitle">Для iOS устройств</span>
            </div>
        </button>
        <button class="btn-store" id="googlePlayBtn">
            <span class="store-icon">
                <img src="GooglePlay.svg" alt="Google Play">
            </span>
            <div class="store-text">
                <span class="store-title">Google Play</span>
                <span class="store-subtitle">Для Android устройств</span>
            </div>
        </button>
        <button class="btn btn-back" id="backFromStoreBtn">Назад</button>
    </div>

    <div id="aboutMenu">
        <h2>О приложении</h2>
        <button class="btn btn-about-item" id="faqFromAboutBtn">Частые вопросы</button>
        <button class="btn btn-about-item" id="termsBtn">Пользовательское соглашение</button>
        <button class="btn btn-about-item" id="improvementBtn">Предложить улучшение</button>
        <button class="btn btn-back" id="backFromAboutBtn">Назад</button>
    </div>

    <div id="faqMenu">
        <h2>Частые вопросы</h2>
        <div class="faq-container">
            <div class="faq-item">
                <div class="faq-question">Как запустить зарядную сессию?</div>
                <div class="faq-answer">Для запуска зарядной сессии необходимо выбрать нужную станцию и коннектор в приложении, установить необходимый объем электроэнергии для зарядки, выбрать способ оплаты, после чего вставить коннектор в электромобиль, дождавшись команды в приложении и, на некоторых станциях, звукового сигнала от станции.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Как оплатить зарядную сессию?</div>
                <div class="faq-answer">Для начала необходимо привязать вашу банковскую карту в приложении, далее с нее будет автоматически списываться необходимая сумма для оплаты зарядной сессии. Тариф за услуги указан при выборе зарядной станции в приложении.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">С какой мощностью будет заряжаться электромобиль?</div>
                <div class="faq-answer">Это зависит от многих факторов, в том числе от уровня заряда автомобиля, температуры, загруженности станции. Максимально возможная мощность отдачи заряда указана в нашем приложении при выборе станции.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Зачем нужна "Красная кнопка" на зарядной станции?</div>
                <div class="faq-answer">На станциях с разъемом CHAdeMO и некоторых станциях переменного тока в соответствии с требованиями к безопасности есть кнопка аварийной остановки станции. Так как кнопка переводит станцию в аварийный режим и делает её недоступной для использования, настоятельная просьба использовать её только в аварийных ситуациях или по указанию службы поддержки, а после использования отжимать кнопку обратно, чтобы другие электромобилисты могли воспользоваться станцией.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Что делать в случае чрезвычайной ситуации?</div>
                <div class="faq-answer">В случае возгорания ЭЗС или появления дыма из неё во время зарядной сессии, необходимо по возможности нажать кнопку аварийной остановки на ЭЗС или остановить зарядку через мобильное приложение или из машины, после чего отключить зарядный кабель, отогнать машину и вызвать пожарную службу. После этого обязательно сообщите о произошедшем в нашу службу технической поддержки!<br><br>
                </div>
            </div>
        </div>
        <button class="btn btn-back" id="backFromFaqBtn">Назад</button>
    </div>

    <div id="termsMenu">
        <h2>Пользовательское соглашение</h2>
        <div class="terms-container">
            <div class="terms-content">
                <h3>Общие положения</h3>
                <p>Настоящее Пользовательское соглашение (далее — «Соглашение») регулирует отношения между владельцем приложения Zer0 Emission (далее — «Сервис») и физическим лицом (далее — «Пользователь»), использующим мобильное приложение и услуги зарядных станций.</p>

                <h3>Условия использования</h3>
                <p>Пользователь соглашается:</p>
                <ul>
                    <li>Использовать Сервис только в законных целях</li>
                    <li>Обеспечивать достоверность предоставляемой информации</li>
                    <li>Соблюдать правила эксплуатации зарядного оборудования</li>
                    <li>Нести ответственность за действия, совершенные с использованием его учетной записи</li>
                </ul>

                <h3>Оплата услуг</h3>
                <p>Стоимость услуг зарядки указывается в приложении перед началом сессии. Оплата производится автоматически с привязанной банковской карты после завершения зарядной сессии.</p>

                <h3>Ответственность</h3>
                <p>Сервис не несет ответственности за:</p>
                <ul>
                    <li>Невозможность использования услуг по причинам, не зависящим от Сервиса</li>
                    <li>Действия третьих лиц</li>
                    <li>Неправильную эксплуатацию оборудования Пользователем</li>
                    <li>Последствия форс-мажорных обстоятельств</li>
                </ul>

                <h3>Конфиденциальность</h3>
                <p>Сервис обязуется не разглашать персональные данные Пользователя третьим лицам, за исключением случаев, предусмотренных законодательством Российской Федерации.</p>

                <p style="text-align: center; color: #666; margin-top: 20px; font-style: italic;">
                    Полная версия пользовательского соглашения доступна на нашем сайте:
                    <a href="https://zero-emission.ru"
                       onclick="window.Telegram.WebApp.openLink('https://zero-emission.ru'); return false;"
                       style="color: #007AFF; text-decoration: none;">
                        zero-emission.ru
                    </a>
                </p>
            </div>
        </div>
        <button class="btn btn-back" id="backFromTermsBtn">Назад</button>
    </div>
</div>

<iframe class="game-frame" id="clumsyBirdFrame" allow="fullscreen" src="about:blank"></iframe>
<iframe class="game-frame" id="pacmanFrame" allow="fullscreen" src="about:blank"></iframe>

<script>
    const tg = window.Telegram.WebApp;
    let currentView = 'main'; // 'main', 'games', 'appstore', 'about', 'faq', 'terms' или 'game'
    let currentGameFrame = null;

    // Инициализация WebApp
    tg.ready();
    tg.expand();
    tg.enableClosingConfirmation();
    tg.BackButton.hide();

    function showMainMenu() {
        currentView = 'main';
        document.getElementById('app').style.display = 'flex';
        document.getElementById('gamesMenu').style.display = 'none';
        document.getElementById('appStoreMenu').style.display = 'none';
        document.getElementById('aboutMenu').style.display = 'none';
        document.getElementById('faqMenu').style.display = 'none';
        document.getElementById('termsMenu').style.display = 'none';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'block';
        });
        tg.BackButton.hide();
    }

    function showGamesMenu() {
        currentView = 'games';
        document.getElementById('app').style.display = 'flex';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'none';
        });
        document.getElementById('gamesMenu').style.display = 'flex';
        document.getElementById('appStoreMenu').style.display = 'none';
        document.getElementById('aboutMenu').style.display = 'none';
        document.getElementById('faqMenu').style.display = 'none';
        document.getElementById('termsMenu').style.display = 'none';
        tg.BackButton.show();
        tg.BackButton.offClick(showMainMenu);
        tg.BackButton.onClick(showMainMenu);
    }

    function showAppStoreMenu() {
        currentView = 'appstore';
        document.getElementById('app').style.display = 'flex';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'none';
        });
        document.getElementById('gamesMenu').style.display = 'none';
        document.getElementById('appStoreMenu').style.display = 'flex';
        document.getElementById('aboutMenu').style.display = 'none';
        document.getElementById('faqMenu').style.display = 'none';
        document.getElementById('termsMenu').style.display = 'none';
        tg.BackButton.show();
        tg.BackButton.offClick(showMainMenu);
        tg.BackButton.onClick(showMainMenu);
    }

    function showAboutMenu() {
        currentView = 'about';
        document.getElementById('app').style.display = 'flex';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'none';
        });
        document.getElementById('gamesMenu').style.display = 'none';
        document.getElementById('appStoreMenu').style.display = 'none';
        document.getElementById('aboutMenu').style.display = 'flex';
        document.getElementById('faqMenu').style.display = 'none';
        document.getElementById('termsMenu').style.display = 'none';
        tg.BackButton.show();
        tg.BackButton.offClick(showMainMenu);
        tg.BackButton.onClick(showMainMenu);
    }

    function showFaqMenu() {
        currentView = 'faq';
        document.getElementById('app').style.display = 'flex';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'none';
        });
        document.getElementById('gamesMenu').style.display = 'none';
        document.getElementById('appStoreMenu').style.display = 'none';
        document.getElementById('aboutMenu').style.display = 'none';
        document.getElementById('faqMenu').style.display = 'flex';
        document.getElementById('termsMenu').style.display = 'none';
        tg.BackButton.show();
        tg.BackButton.offClick(showAboutMenu);
        tg.BackButton.onClick(showAboutMenu);
    }

    function showTermsMenu() {
        currentView = 'terms';
        document.getElementById('app').style.display = 'flex';
        document.querySelectorAll('#app > button').forEach(btn => {
            btn.style.display = 'none';
        });
        document.getElementById('gamesMenu').style.display = 'none';
        document.getElementById('appStoreMenu').style.display = 'none';
        document.getElementById('aboutMenu').style.display = 'none';
        document.getElementById('faqMenu').style.display = 'none';
        document.getElementById('termsMenu').style.display = 'flex';
        tg.BackButton.show();
        tg.BackButton.offClick(showAboutMenu);
        tg.BackButton.onClick(showAboutMenu);
    }

    function openGame(frameId) {
        currentView = 'game';
        currentGameFrame = frameId;

        const gameUrls = {
            clumsyBirdFrame: 'https://izhenergo.github.io/Clumsy_Bird/',
            pacmanFrame: 'https://izhenergo.github.io/Pacman_Canvas/',
        };

        document.getElementById('app').style.display = 'none';
        const frame = document.getElementById(frameId);
        frame.src = gameUrls[frameId];
        frame.style.display = 'block';

        tg.BackButton.show();
        tg.BackButton.offClick(closeGame);
        tg.BackButton.onClick(closeGame);
    }

    function closeGame() {
        const frame = document.getElementById(currentGameFrame);
        frame.src = 'about:blank';
        frame.style.display = 'none';
        showGamesMenu();
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('app').classList.add('visible');
            showMainMenu();
        }, 1500);

        // Назначение обработчиков
        document.getElementById('playBtn').addEventListener('click', showGamesMenu);
        document.getElementById('appBtn').addEventListener('click', showAppStoreMenu);
        document.getElementById('aboutBtn').addEventListener('click', showAboutMenu);
        document.getElementById('supportBtn').addEventListener('click', () => {
            tg.openTelegramLink('https://t.me/Zer0_Emission_Support');
        });
        document.getElementById('improvementBtn').addEventListener('click', () => {
            tg.openTelegramLink('https://t.me/Zer0_Emission_Support');
        });

        // Обработчики кнопок назад
        document.getElementById('backBtn').addEventListener('click', showMainMenu);
        document.getElementById('backFromStoreBtn').addEventListener('click', showMainMenu);
        document.getElementById('backFromAboutBtn').addEventListener('click', showMainMenu);
        document.getElementById('backFromFaqBtn').addEventListener('click', showAboutMenu);
        document.getElementById('backFromTermsBtn').addEventListener('click', showAboutMenu);

        // Обработчики игр
        document.getElementById('clumsyBirdBtn').addEventListener('click', () => openGame('clumsyBirdFrame'));
        document.getElementById('pacmanBtn').addEventListener('click', () => openGame('pacmanFrame'));

        // Обработчики магазинов приложений
        const APP_STORE_URL = 'https://apps.apple.com/ru/app/zero-emission/id1632884066';
        const GOOGLE_PLAY_URL = 'https://play.google.com/store/apps/details?id=ru.zero.emission.app';

        document.getElementById('appStoreBtn').addEventListener('click', () => {
            tg.openLink(APP_STORE_URL);
        });

        document.getElementById('googlePlayBtn').addEventListener('click', () => {
            tg.openLink(GOOGLE_PLAY_URL);
        });

        // Обработчики меню "О приложении"
        document.getElementById('faqFromAboutBtn').addEventListener('click', showFaqMenu);
        document.getElementById('termsBtn').addEventListener('click', showTermsMenu);

        // Обработчики для FAQ
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const item = question.parentElement;
                item.classList.toggle('active');
            });
        });

        // Блокировка скролла только для body, но разрешаем для контейнеров с контентом
        document.body.addEventListener('touchmove', (e) => {
            // Разрешаем скролл только для элементов с overflow
            if (e.target.closest('.faq-container') || e.target.closest('.terms-container') ||
                e.target.closest('#gamesMenu') || e.target.closest('#appStoreMenu') ||
                e.target.closest('#aboutMenu') || e.target.closest('#faqMenu') ||
                e.target.closest('#termsMenu')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
    });
</script>
</body>
</html>
